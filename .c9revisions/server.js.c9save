{"ts":1362322072616,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"'use strict';\r\n\r\nvar restify = require('restify')\r\n  , db      = require('./db');\r\n\r\nvar server = restify.createServer({\r\n  name: 'json-server'\r\n});\r\n\r\nserver.use(restify.bodyParser());\r\nserver.use(restify.queryParser());\r\n\r\nserver.get('/get', getTranslations);\r\nserver.post('/create', createTranslation); // curl --data \"userId=1&dictionary=1&originalTranslationId=0&fromWord=Fisk&fromDescription=&toWord=Zivis&toDescription=\" localhost:8080/vocababe/create\r\nserver.put('/update', updateTranslation);\r\nserver.del('/delete', deleteTranslation);\r\n\r\nserver.listen(8080, function() {\r\n  console.log('%s listening at %s', server.name, server.url);\r\n});\r\n\r\nfunction callback (err, result) {\r\n  return err ? res.send(err) : res.json(result);\r\n}\r\n\r\nfunction getTranslations(req, res) {\r\n  var fields = [\r\n    req.params.userId,\r\n    req.params.dictionary,\r\n    req.params.lastChanged\r\n  ];\r\n  if (req.params.lastChanged) {\r\n    db.getTranslationsByDate(fields, function (err, result) {   return err ? res.send(err) : res.json(result); });\r\n  } else {\r\n    db.getTranslationsByDictionary(fields, function (err, result) {   return err ? res.send(err) : res.json(result); });\r\n  }\r\n  console.log(fields);\r\n}\r\n\r\nfunction getTranslationsByDate(req, res) {\r\n  var fields = [\r\n    req.params.lastChanged,\r\n    req.params.userId,\r\n    req.params.dictionary\r\n  ];\r\n  console.log(fields);\r\n  db.getTranslationsById(fields, function (err, result) {   return err ? res.send(err) : res.json(result); });\r\n}\r\n\r\nfunction test(req, res) {\r\n  res.send(\"hey \" + JSON.stringify(req.params));\r\n}\r\n\r\nfunction createTranslation(req, res) {\r\n  var fields = [\r\n    req.params.userId,\r\n    req.params.dictionary,\r\n    req.params.fromWord,\r\n    req.params.fromDescription,\r\n    req.params.toWord,\r\n    req.params.toDescription,\r\n    req.params.originalTranslationId\r\n  ];\r\n  db.createTranslation(fields, function (err, result) {\r\n    if (err) {\r\n      return res.json({\"error\":\"something went wrong\" + err});\r\n    }\r\n    res.json(result.insertId);\r\n  });\r\n}\r\n\r\nfunction updateTranslation(req, res) {\r\n  var fields = [\r\n    req.params.fromWord,\r\n    req.params.fromDescription,\r\n    req.params.toWord,\r\n    req.params.toDescription,\r\n    req.params.userId,\r\n    req.params.id\r\n  ];\r\n  console.log(fields);\r\n  db.updateTranslation(fields, function (err, result) {   return err ? res.send(err) : res.json(result); });\r\n}\r\n\r\nfunction deleteTranslation(req, res) {\r\n  var fields = [\r\n    req.params.userId,\r\n    req.params.id\r\n  ];\r\n  console.log(fields);\r\n  db.deleteTranslation(fields, function (err, result) {   return err ? res.send(err) : res.json(result); });\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2632}]],"length":2632}
